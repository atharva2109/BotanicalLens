<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Plant</title>
    <link rel="stylesheet" href="./stylesheets/addplant/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<h1 class="title">Add Plant</h1>

<ul id="subtitles">
    <li id="userIdSection">User ID</li>
    <li id="plantNameSection">Plant Name</li>
    <li id="plantDescriptionSection">Plant Description</li>
    <li id="categorySection">Category</li>
    <li id="chooseDateSection">Choose Date</li>
    <li id="pickLocationSection">Pick Location</li>
    <li id="uploadImageSection">Upload Image</li>
    <li id="submitSection">Submit</li>
</ul>
<form action="/addplant" method="post" enctype="multipart/form-data">
    <div class="input-area text-center" style="margin-top: 20px;">
        <!-- User ID Input and Next/Back Button -->
        <div id="userIdInputSection">
            <input type="text" id="userIdInput" class="input-field form-control" placeholder="Enter your User ID">
            <button id="nextUserId" class="btn btn-primary">Next</button>
    </div>

        <!-- Plant Name Input and Next/Back Button -->
        <div id="plantNameInputSection" style="display: none;">
            <input type="text" id="plantNameInput" class="input-field form-control" placeholder="Enter Plant Name">
            <button id="nextPlantName" class="btn btn-primary">Next</button>
            <button id="backPlantName" class="btn btn-secondary">Back</button>
         </div>

        <!-- Plant Description Input and Next/Back Button -->
        <div id="plantDescriptionInputSection" style="display: none;">
            <textarea id="plantDescriptionInput" class="form-control" placeholder="Enter Plant Description" rows="4"></textarea>
            <button id="nextPlantDescription" class="btn btn-primary">Next</button>
            <button id="backPlantDescription" class="btn btn-secondary">Back</button>
        </div>

        <!-- Category Dropdown menu and Next/Back Button -->
        <div id="categoryInputSection" style="display: none;">
            <label for="plantCategory">Category:</label>
            <select id="plantCategory" class="form-control">
                <option value="">Select a Category</option>
                <option value="herb">Herb</option>
                <option value="shrub">Shrub</option>
                <option value="tree">Tree</option>
                <option value="flower">Flower</option>
            </select>
            <button id="nextCategorySection" class="btn btn-primary">Next</button>
            <button id="backCategorySection" class="btn btn-secondary">Back</button>
        </div>

        <!--    Choose Date menu and Next/Back Button-->
        <div id="chooseDateInputSection" style="display: none;">
            <label for="chooseDate">Choose Date:</label>
            <input type="date" id="chooseDate" name="chooseDate" class="form-control">
            <button id="nextChooseDateSection" class="btn btn-primary">Next</button>
            <button id="backChooseDateSection" class="btn btn-secondary">Back</button>
        </div>

        <!--    Pick Location(map API) and Next/Back Button-->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPwovx_RfcG7uV-3MrFSiyz2ChuQU62NM&callback=initMap" async defer></script>
        <script>
            let map, marker;

            function initMap() {
                const defaultLocation = { lat: 53.3817639, lng: -1.4826869 }; // Default location: The Diamond
                map = new google.maps.Map(document.getElementById("map"), {
                    center: defaultLocation,
                    zoom: 15,
                });

                // Allow user to place a marker on the map
                map.addListener("click", (e) => {
                    if (marker) marker.setMap(null); // Remove the previous marker, if any

                    marker = new google.maps.Marker({
                        position: e.latLng,
                        map: map,
                    });
                });
            }
        </script>
        <div id="pickLocationInputSection" style="display: none;">
            <label for="pickLocation">Please Pick a Location:</label>
            <div id="map" style="height: 400px; width: 600px;"></div>
            <button id="nextPickLocationSection" class="btn btn-primary">Next</button>
            <button id="backPickLocationSection" class="btn btn-secondary">Back</button>
        </div>

        <!--    Upload Image and Next/Back Button-->
        <div id="uploadImageInputSection" style="display: none;">
            <label for="uploadImage">Please Upload Image:</label>
            <input type="file" id="uploadImage" name="uploadImage" accept="image/*">
            <button id="nextUploadImageSection" class="btn btn-primary">Next</button>
            <button id="backUploadImageSection" class="btn btn-secondary">Back</button>
        </div>
        <!--    Submit section and Back Button-->
        <div id="submitInputSection" style="display:none;">
            <div id="summary">
                <!--display the details-->
            </div>
            <button id="backSubmitSection" class="btn btn-primary">Back</button>
            <button type="submit" class="btn btn-success">Add Plant</button>
        </div>
    </div>
</form>

<script>
    const userIdInputSection = document.getElementById('userIdInputSection');
    const plantNameInputSection = document.getElementById('plantNameInputSection');
    const plantDescriptionInputSection = document.getElementById('plantDescriptionInputSection');
    const categoryInputSection = document.getElementById('categoryInputSection');
    const chooseDateInputSection = document.getElementById('chooseDateInputSection');
    const pickLocationInputSection = document.getElementById('pickLocationInputSection');
    const uploadImageInputSection = document.getElementById('uploadImageInputSection');
    const submitInputSection = document.getElementById('submitInputSection')

    const nextUserIdButton = document.getElementById('nextUserId');
    const nextPlantNameButton = document.getElementById('nextPlantName');
    const nextPlantDescriptionButton = document.getElementById('nextPlantDescription');
    const nextCategorySectionButton = document.getElementById('nextCategorySection');
    const nextChooseDateSectionButton = document.getElementById('nextChooseDateSection');
    const nextPickLocationSectionButton = document.getElementById('nextPickLocationSection');
    const nextUploadImageSectionButton = document.getElementById('nextUploadImageSection');

    const backPlantNameButton = document.getElementById('backPlantName');
    const backPlantDescriptionButton = document.getElementById('backPlantDescription');
    const backCategorySectionButton = document.getElementById('backCategorySection');
    const backChooseDateSectionButton = document.getElementById('backChooseDateSection');
    const backPickLocationSectionButton = document.getElementById('backPickLocationSection');
    const backUploadImageSectionButton = document.getElementById('backUploadImageSection');
    const backSubmitSectionButton = document.getElementById('backSubmitSection');

    const subtitles = document.querySelectorAll('#subtitles li');
    let activeIndex = 0;

    function highlightCurrent() {
        userIdInputSection.style.display = 'none';
        plantNameInputSection.style.display = 'none';
        plantDescriptionInputSection.style.display = 'none';
        categoryInputSection.style.display = 'none';
        chooseDateInputSection.style.display = 'none';
        pickLocationInputSection.style.display = 'none';
        uploadImageInputSection.style.display = 'none';
        submitInputSection.style.display = 'none';

        if (activeIndex === 0) {
            userIdInputSection.style.display = 'block';
        } else if (activeIndex === 1) {
            plantNameInputSection.style.display = 'block';
        } else if (activeIndex === 2) {
            plantDescriptionInputSection.style.display = 'block';
        } else if (activeIndex === 3) {
            categoryInputSection.style.display = 'block';
        } else if (activeIndex === 4) {
            chooseDateInputSection.style.display = 'block';
        } else if (activeIndex === 5) {
            pickLocationInputSection.style.display = 'block';
        } else if (activeIndex === 6) {
            uploadImageInputSection.style.display = 'block';
        } else if (activeIndex === 7) {
            submitInputSection.style.display = 'block';
        }

        subtitles.forEach((item, index) => {
            item.classList.remove('active');
            if (index === activeIndex) {
                item.classList.add('active');
            }
        });
    }

    nextUserIdButton.addEventListener('click', () => {
        activeIndex = 1; // Move to Plant Name section
        highlightCurrent();
    });
    nextPlantNameButton.addEventListener('click', () => {
        activeIndex = 2; // Move to Plant Description section
        highlightCurrent();
    });
    nextPlantDescriptionButton.addEventListener('click', () =>{
        activeIndex = 3; // Move to Category section
        highlightCurrent();
    });
    nextCategorySectionButton.addEventListener('click', () =>{
        activeIndex = 4; // Move to Choose Date section
        highlightCurrent();
    });
    nextChooseDateSectionButton.addEventListener('click', () =>{
        activeIndex = 5; //Move to Pick Location section
        highlightCurrent();
    });
    nextPickLocationSectionButton.addEventListener('click', () =>{
        activeIndex = 6; //Move to Upload Image section
        highlightCurrent();
    });
    nextUploadImageSectionButton.addEventListener('click', () =>{
        activeIndex = 7; // Move to Submit section
        updateSummary(); // Update summary with the latest details
        highlightCurrent();
    })

    backPlantNameButton.addEventListener('click', () => {
        activeIndex = Math.max(activeIndex - 1, 0); // Go back to User ID section
        highlightCurrent();
    });
    backPlantDescriptionButton.addEventListener('click', () => {
        activeIndex = 1; // Go back to Plant Name section
        highlightCurrent();
    });
    backCategorySectionButton.addEventListener('click', () => {
        activeIndex = 2; // Go back to Plant Description section
        highlightCurrent();
    });
    backChooseDateSectionButton.addEventListener('click', () => {
        activeIndex = 3; // Go back to Category section
        highlightCurrent();
    });
    backPickLocationSectionButton.addEventListener('click', () => {
        activeIndex = 4; // Go back to Choose Date section
        highlightCurrent();
    });
    backUploadImageSectionButton.addEventListener('click', () => {
        activeIndex = 5; // Go back to Pick Location section
        highlightCurrent();
    });
    backSubmitSectionButton.addEventListener('click', () =>{
        activeIndex = 6; // Go back to Upload Image section
        highlightCurrent();
    })

    document.addEventListener('DOMContentLoaded', () => {
        highlightCurrent(); // Initially set the correct visibility and highlight
    });


    function updateSummary() {
        const userId = document.getElementById('userIdInput').value;
        const plantName = document.getElementById('plantNameInput').value;
        const plantDescription = document.getElementById('plantDescriptionInput').value;
        const category = document.getElementById('plantCategory').value;
        const chooseDate = document.getElementById('chooseDate').value;
        const pickedLocation = marker ? marker.getPosition().toUrlValue() : 'No location selected';
        const uploadedImage = document.getElementById('uploadImage').files[0] ? document.getElementById('uploadImage').files[0].name : 'No image uploaded';

        document.getElementById('summary').innerHTML = `
                        <p><strong>User ID:</strong> ${userId}</p>
                        <p><strong>Plant Name:</strong> ${plantName}</p>
                        <p><strong>Plant Description:</strong> ${plantDescription}</p>
                        <p><strong>Category:</strong> ${category}</p>
                        <p><strong>Choose Date:</strong> ${chooseDate}</p>
                        <p><strong>Picked Location:</strong> ${pickedLocation}</p>
                        <p><strong>Uploaded Image:</strong> ${uploadedImage}</p>
                    `;
    }
</script>
</body>
</html>
